sudo: false
language: ruby
cache:
  bundler: true
  directories:
  - ".downloads"
  - node_modules
  - tmp/cache/assets/test
  - vendor/assets/bower_components
env:
  global:
  - PATH=$PWD/bin:$PATH
  - secure: DyXBK6bjM0hmuc9caGjpZKpHHzeUdxTwkhGMrrAtUUyVC6i9PH/UL0Keq9rSZs50IwFiC9dCumvUOxNH4SbAMmrJjpw6WHiPG6sZ01x/M/kEbi9QVMe3xu1DPbqpZE0IgeyTXw4D6E6go1SMSrfYenz1qvRV8h7fmJqCjf+UnptWiOfYXeAAFXKvdbbItZs4ABNMtHJ+eP1QKFqQZc5MBNwyA+FZf3HfTipCOQrpTq9W8UG5qaQA5phes6U2s0MdnJJEYQcWr1rMxLA5Z1F+wI9+XtsW6MC0HpJnBQNtLeGDLzHSDv/OivB7/aXXSF9xHh9V0bZWkkpmF1P2EsgWlYPrKRVlgcVnMSLrhPgdUmR7E5Smjyyetdq2I7VmRyw9XbpqJlRWe8N4vUV8SfluzFDSj6M8bXROhnPo6ttYSlCbIMpobd7Z8ZICkv61M4ub3fm8t8feMv7R1bIN3Uh+LXCtM/5yuCiKGOVW0s4XnDOegpBZMk6PSJQq0vD0rYAGvYln2eZs/jZMfZPmRQ28l4RfUQIM1YH85O+14zZ9G4v4fcjafJ9opHxX0cLrHbCfG2528gJKQrvgMiaV/sieqSkromN20AV0A4cTc0onw7Q+sXKjBlY1Jo9SdxnCDc215hCHf0yrwVMy78M2zT6O3W5dqZ6A6QmdrPkbcFx3ihc=
node_js:
- '0.10'
rvm:
- 2.3.0
before_install:
- echo -e "machine github.com\n  login $CI_USER_TOKEN" >> ~/.netrc
before_script:
- "[ -d .downloads ] || mkdir .downloads"
- "(cd .downloads; [ -d prince-9.0r5-linux-amd64-static ] || curl -s http://www.princexml.com/download/prince-9.0r5-linux-amd64-static.tar.gz
  | tar xzf -)"
- echo $PWD | ./.downloads/prince-9.0r5-linux-amd64-static/install.sh
- npm install
- "./bin/rake db:setup RAILS_ENV=test"
deploy:
  provider: heroku
  api_key:
    secure: bAJPtpNictsZLpt7f+mJVmzpRFRKuXYsUC12ASAi2z4XqWnGpo7ZUSkE9D9zZ7fJAgLVIsjh15+frLyGI5knfhsdsKu/FQSR3JUwH80FMiOoMBUbfMNvgaz58lqMC18KVJZ7peG9LvcmIhHeX+WS2nZEfUIPCmbVWTtGh6NIzrqlv5DjqHtXOVAoibnqNKd2wU0Oe43PwDbYKGcUWwlzuzmPT4hpkS0UfEaOcU0dtP3480/uQpbElpgC/gFN+HAkyB3ZLFPeaPJuT5ZZAPBJY5Mo3hdI+F5FWJUue3oFYWP3hZVW55b/ipB6/PcOM9iFqe5LJXN3kiykjo/f6Pj9m/2DKBmWcTA+AQP7ywstz6aZvoTo+YpiF5nTHndH9wytpGZIsxYtHa0JsKo1ZjrhKOUl8o7faa/mqA9v6obMqwAU86uauH75lrliNopmAo/jVmOhrvQEn1YI8c0KSHS5p3fkgaeaVE1Zu57JecUcyfBDuDfImZpZaNzoeiYmFbOU+UdCl6i7qTriHZVgkRpjiTTae0PNP1jwwUd9D98rZovjBWOy1Dg4xpwHz4dTicCOQeuksbl5IBS0RO9EpDDbjNUV729Wc16TF0haayH84W3HYeQ5/cbQWjIWTegG0J/3/Xh4puYcPpwUv10tuT+8VGaJSnGNMIwFE9z4MOWC/0I=
  app: staging-summary-gen-pw-gov-uk
  on:
    repo: guidance-guarantee-programme/summary_generator
  run: "./bin/rake db:migrate"
notifications:
  slack:
    rooms:
      secure: Vs2DeS+epX6RWhjzJlyqQ4JPBjyDSIxwJj1PqwS1/qhLWLdlmCPsErEdkwuLxJtfZSrHD/dK6XAaaJTFwTlSLWIQdz46I7ASdvMsRiVXb6rN85XOyxg9cmBbda/XXvxUBdXWZhOp1X7aZlUtO+KEPBvzzwvHZfSlKPtqWL+EleG3Od/7EXvjlqW4eOEc/JMdn2jpjV3Cct7DjWusrB73vSui3VHfHDdl1piaWHZOVq7bQ1BkktIFMUwtu7nXy0jnnOXm3OPoqaIMpDPwjgnmhcd58v3nCAYgNqDY7eUAH+OESXj6aycjK9AgvLH7Y+R2dplQQebr2b+Kq4e/eKXPo8THcASN69d18jwgqeEMePXtEPQoUjRvn8VN1B8iKQnbZoFqTzcKCkNihzfW7HAyZbzQ5M8Oich/juTvfXcA+PqLkj7sFP1epgeDdUr2sD/dOJBG22nrC1AEl09Vi7YJdbOut/zJP3/DzvECsjQkGtOuGxjKMfTCFm4p9g2UIHvzDhxyfwhIes2a5gcRGW5UHjUzQLobKFQx648ion+cty5mFZfFU2ZSqJb8RlDKUZkN4imypj6GGqjTbdP1dHdCwm9jQa/bEYqclgLf04VZ/3M0CSw7VPIdBoL9aMDTP6RNGwkom1UYMwYJ9gc9nqyQlDNpeu9DY+JtKK6m30J9OuU=

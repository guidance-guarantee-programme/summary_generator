<%= form_for @appointment_summary, url: preview_appointment_summaries_path do |f| %>
  <div class="page-header">
    <h1><%= title 'New appointment summary' %></h1>
  </div>

  <p class="lead">Use this form to enter the visitor's personal details given during the guidance
    appointment and to issue a personalised summary document.</p>

  <div class="display_if_consent">
    <% if @appointment_summary.errors.any? %>
      <div class="alert alert-danger" role="alert">
        <h2 class="alert__heading">There's a problem</h2>
        <ul>
          <% @appointment_summary.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <h2>Visitor details</h2>

    <div class="form-group">
      <%= f.label :title %>
      <%= f.select :title, AppointmentSummary::TITLES,
                   { prompt: true }, { class: %w(form-control input-md-2 t-title) } %>
    </div>

    <div class="form-group">
      <%= f.label :first_name %>
      <%= f.text_field :first_name, class: %w(form-control input-md-3 t-first-name) %>
    </div>

    <div class="form-group">
      <%= f.label :last_name %>
      <%= f.text_field :last_name, class: %w(form-control input-md-3 t-last-name) %>
    </div>

    <h3 id="postal-address-heading">Postal address</h3>

    <div class="form-group">
      <%= f.label :address_line_1 do %>Building and street <span class="visuallyhidden">line 1</span><% end %>
      <%= f.text_field :address_line_1, class: %w(form-control input-md-3 t-address-line-1) %>
    </div>

    <div class="form-group">
      <%= f.label :address_line_2, class: 'visuallyhidden' %>
      <%= f.text_field :address_line_2, class: %w(form-control input-md-3 t-address-line-2) %>
    </div>

    <div class="form-group">
      <%= f.label :address_line_3, class: 'visuallyhidden' %>
      <%= f.text_field :address_line_3, class: %w(form-control input-md-3 t-address-line-3) %>
    </div>

    <div class="form-group">
      <%= f.label :town %>
      <%= f.text_field :town, class: %w(form-control input-md-3 t-town) %>
    </div>

    <div class="form-group">
      <%= f.label :county, 'County (optional)' %>
      <%= f.text_field :county, class: %w(form-control input-md-3 t-county) %>
    </div>

    <div class="form-group">
      <%= f.label :postcode %>
      <%= f.text_field :postcode, class: %w(form-control input-md-2 t-postcode) %>
    </div>

    <div class="form-group">
      <%= f.label :country, 'Country' %>
      <%= f.select :country, Countries.all, {}, class: %w(form-control input-md-3 t-country) %>
    </div>

    <h3>Appointment</h3>

    <div class="form-group">
      <%= f.label :date_of_appointment %>
      <%= f.date_field :date_of_appointment,
                       class: %w(form-control input-md-2 t-date-of-appointment) %>
    </div>

    <h2>Guider details</h2>

    <div class="form-group">
      <%= f.label :guider_name %>
      <%= f.text_field :guider_name, class: %w(form-control input-md-3 t-guider-name) %>
    </div>

    <div class="form-group">
      <fieldset>
        <legend>
          <span>Organisation</span>
        </legend>

        <div class="radio">
          <%= f.label :guider_organisation, value: 'citizens_advice' do %>
            <%= f.radio_button :guider_organisation, 'citizens_advice',
                               class: 't-guider-organisation-citizens-advice' %>
            Citizens Advice
          <% end %>
        </div>
      </fieldset>
    </div>

    <hr>

    <h2>Pension pot details</h2>

    <div class="form-group">
      <fieldset>
        <legend>
          <span>Does visitor have a defined contribution pension?</span>
        </legend>
        <div class="radio">
          <%= f.label :has_defined_contribution_pension, value: 'yes' do %>
            <%= f.radio_button :has_defined_contribution_pension, 'yes',
                               class: 't-has-defined-contribution-pension-yes' %>
            Yes
          <% end %>
        </div>
        <div class="radio">
          <%= f.label :has_defined_contribution_pension, value: 'no' do %>
            <%= f.radio_button :has_defined_contribution_pension, 'no',
                               class: 't-has-defined-contribution-pension-no' %>
            No
          <% end %>
        </div>
        <div class="radio">
          <%= f.label :has_defined_contribution_pension, value: 'unknown' do %>
            <%= f.radio_button :has_defined_contribution_pension, 'unknown',
                               class: 't-has-defined-contribution-pension-unknown' %>
            Don't know
          <% end %>
        </div>
      </fieldset>
    </div>

    <div class="display_if_eligible">
      <h2>Supplementary information</h2>

      <div class="form-group">
        <legend>Does visitor need supplementary information about any of the following?</legend>

        <div class="checkbox">
          <%= f.label :supplementary_benefits do %>
            <%= f.check_box :supplementary_benefits,
                            class: 't-supplementary-benefits' %>
            Benefits and pension income
          <% end %>
        </div>

        <div class="checkbox">
          <%= f.label :supplementary_debt do %>
            <%= f.check_box :supplementary_debt,
                            class: 't-supplementary-debt' %>
            Debt and pensions
          <% end %>
        </div>

        <div class="checkbox">
          <%= f.label :supplementary_ill_health do %>
            <%= f.check_box :supplementary_ill_health,
                            class: 't-supplementary-ill-health' %>
            Pensions and ill health
          <% end %>
        </div>

        <div class="checkbox">
          <%= f.label :supplementary_defined_benefit_pensions do %>
            <%= f.check_box :supplementary_defined_benefit_pensions,
                            class: 't-supplementary-defined-benefit-pensions' %>
            Final salary or career average pensions
          <% end %>
        </div>
      </div>
    </div>

    <h2>Summary document</h2>

    <div class="form-group">
      <fieldset>
        <legend>
          <span>Format preference</span>
        </legend>
        <div class="radio">
          <%= f.label :format_preference, value: 'standard' do %>
            <%= f.radio_button :format_preference, 'standard',
                               class: 't-format-preference-standard' %>
            Standard
          <% end %>
        </div>
        <div class="radio">
          <%= f.label :format_preference, value: 'large_text' do %>
            <%= f.radio_button :format_preference, 'large_text',
                               class: 't-format-preference-large-text' %>
            Large text
          <% end %>
        </div>
      </fieldset>
    </div>

    <p>
      <%= f.submit 'Preview', class: %w(btn-success t-submit btn-lg) %>
    </p>

  </div>
<% end %>

<script type="text/html" id="consent">
  <div class="checkbox">
    <label for="appointment_summary_consent">
      <input class="t-continue-working" type="checkbox" value="1" name="appointment_summary[consent]" id="appointment_summary_consent" />
      Visitor has consented to sharing data for purpose of creating and sending summary document
    </label>
  </div>
</script>

<script type="text/html" id="postcode-lookup-template">
  <div class="form-group form-inline postcode-lookup" id="postcode-lookup">
    <label for="appointment_summary_lookup" class="visuallyhidden">Postcode or address to search for</label><br>
    <input class="form-control input-md-3 add-right-margin" placeholder="Enter postcode or address" type="text" id="postcode-lookup-input" />
    <button class="btn-success btn-sm" onclick="return false" id="postcode-lookup-button">Find UK address</button>
  </div>
  <div class="form-group form-inline" id="postcode-lookup-results-container">
  </div>
</script>

<script type="text/html" id="pension-pot-accuracy">
  <div class="col-md-3 col-accuracy">
    <div class="form-group">
      <fieldset>
        <legend>
          <span>How accurate is the value given by the caller?</span>
        </legend>
        <div class="radio">
          <label for="appointment_summary_accuracy_1">
            <input checked="checked" type="radio" value="exact" name="appointment_summary[accuracy]" id="appointment_summary_accuracy_1" />
            Exact
          </label>
        </div>
        <div class="radio">
          <label for="appointment_summary_accuracy_2">
            <input type="radio" value="approximate" name="appointment_summary[accuracy]" id="appointment_summary_accuracy_2" />
            Approximate
          </label>
        </div>
        <div class="radio">
          <label for="appointment_summary_accuracy_3">
            <input type="radio" value="range" name="appointment_summary[accuracy]" id="appointment_summary_accuracy_3" />
            A range
        </label>
        </div>
        <div class="radio">
          <label for="appointment_summary_accuracy_4">
            <input type="radio" value="notprovided" name="appointment_summary[accuracy]" id="appointment_summary_accuracy_4" />
            No value given
          </label>
        </div>
      </fieldset>
    </div>
  </div>
</script>

<script type="text/html" id="pension-pot-input-error">
  <span id="errmsg" class="error"></span>
</script>

<script type="text/html" id="pension-pot-preview">
  <div class="preview">
    <div class="preview__context">Document preview</div>
    <p class="preview__heading">What you told us about your pension pot</p>

    <p class="preview__intro">This is your personal or workplace pension based on how much has been paid<br />
      into your pot (defined contribution pension).</p>

    <p class="preview__label">Total value of your pension pot:</p>
    <p class="preview__amount">Â£</p>
    <p class="preview__note">If you have more than one pot this is their combined value.</p>
  </div>
</script>

<% content_for :body_end do %>
  <%= javascript_include_tag 'application' %>
<% end %>
